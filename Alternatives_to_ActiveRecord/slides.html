<!DOCTYPE html>
<html>
  <head>
    <title>Alternatives to ActiveRecord</title>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8"/>
    <style type="text/css">
      @import url(https://fonts.googleapis.com/css?family=Yanone+Kaffeesatz);
      @import url(https://fonts.googleapis.com/css?family=Droid+Serif:400,700,400italic);
      @import url(https://fonts.googleapis.com/css?family=Ubuntu+Mono:400,700,400italic);

      body {
        font-family: 'Droid Serif';
      }
      footer {
        display: block;
        bottom: 0;
        position: absolute;
        color: #888;
        margin-bottom: -10px;
        margin-left: -90px;
        font-size: 20px;
      }
      h1, h2, h3 {
        font-family: 'Yanone Kaffeesatz';
        font-weight: normal;
      }
      .remark-slides-area { background-color: #9B111E; }
      .remark-slide-content {
        font-size: 26px; line-height: 1.6;
      }
      .remark-slide-number { font-size: 18px; }
      .remark-code, .remark-inline-code { font-family: 'Ubuntu Mono'; }
      .remark-slide .title li {
        list-style-type: none;
        font-size: 28px;
      }
      .remark-slide .title ul {
        padding-left: 0px;
      }
      .remark-slide .title h1 {
        font-size: 60px;
      }
      .remark-slide li p {
        margin: 0;
      }
      a {
        text-decoration: none;
        border-bottom: 1px #666666 dashed;
        color: #202;
      }
      a:hover {
        color: #505;
        background-color: #DD0;
      }

    </style>
  </head>
  <body>
    <textarea id="source">
class: title, middle, center

# Alternatives to ActiveRecord

* by Craig Buchek


* WindyCityRails
* September 17-18, 2015


http://tinyurl.com/ar-alt-wcr


---
layout: true

<footer>
  <p>@CraigBuchek</p>
</footer>

---

About Me
========

* Independent web developer
  * [BoochTek][boochtek]
* Ruby / Rails programmer since 2006
* Agile practitioner
  * [This Agile Life][tal] podcast
* Boring slide designer

---

ActiveRecord
============

* Ubiquitous
  * Everyone knows it
  * Lots of people improving it
  * Plugins usually assume you're using it
  * Documentation
* Well-tested
* Well-understood
* Easy to use - it comes with Rails

???

* Who here uses ActiveRecord?
* Who hasn't used ActiveRecord?
* Who loves ActiveRecord?
* Who hates ActiveRecord?
* Who both loves and hates ActiveRecord?
* I hate ActiveRecord - mostly
* But ActiveRecord is the 800-pount gorilla
* Odds are, if you're hired to work on Rails, you'll be using AR

---

ActiveRecord - Size
===================

* Rails is 270 kloc
* ActiveRecord is 210 kloc
* Adds about 300 instance methods
* Adds about 400 class methods

???

* ActiveRecord is **big**
* kloc = 1000 lines of code
* LOC stats are from Sean Griffin, [Ruby Rogues episode 222][rr-222]
* Method stats are from a Rails 4.2 model w/ 1 field

---

Active Record Pattern
=====================

* Active Record pattern
* Persistence logic in same class as domain logic
* Violates Single Responsibility Principle


* ActiveRecord ORM uses the pattern

???

* But it's not the size of ActiveRecord that's the biggest problem
  * The biggest problem is that it encourages bad engineering habits
    * This is mostly because it violates the SRP
    * The size of AR is just a symptom of the SRP violation
* Note "Active Record" for the pattern and "ActiveRecord" for the ORM
* Active Record pattern described by Martin Fowler
  * [Patterns of Enterprise Application Architecture][peap]
* My experience is that AR breaks down at about 20 model classes
  * Data Mapper pattern has some advantages with only a few classes
    * But has a little more overhead in the number of classes/concepts

---

ORM
===

* Object-Relational Mapper (ORM)


* Connects your app to your database


* Ruby - objects
* SQL - relations

???

* SQL databases deal with relations
  * Relational algebra
* Caveat: there's an "impedance mismatch" between the 2 sides
* Some of the "ORMs" we'll look at don't actually do the mapping part

---

DataMapper
==========

* Actually uses the Active Record pattern
* Supports a lot more than just SQL on the back end
* No further development
  * Last updated 2012-08-27

???

* Seemed to be the best way forward for a few years

---

Sequel
======

* Good documentation
* Leverages database features
  * Like foreign key constraints
* Supports almost any SQL database you can think of
* Thread safety, connection pooling

???

* Biggest surprise when I did research for the 1st version of this talk last year
* Written by Jeremy Evans
  * Winner of a Ruby Hero award earlier this year

---

Sequel
======

* Awesome feature - set a model to a subset of a table

~~~ ruby
DB = Sequel.connect("sqlite://blog.db")
class Post < Sequel::Model
  set_primary_key [:category, :title]
  set_dataset DB[:my_posts].where(category: "ruby")
    .select(:category, :title, :content).order(:date)
end
~~~

---

Lotus::Model
============

* Data Mapper pattern
* SQL (via Sequel), memory, and file adapters
* Version 0.4.1
* Follows Data-Driven Design architecture
  * Entity
  * Repository
  * Mapper
  * Query

---

ROM
===

* Ruby Object Mapper
* Started life as DataMapper 2
* Taking longer to get to 1.0 than hoped
  * But RC is just around the corner
* Supports SQL (via Sequel), MongoDB, YAML, HTTP
  * Can support almost any data source, via adapters

???

* Initially meant to implement the Data Mapper pattern
* Renamed from DM2 to ROM in 2013
* Moved away from object-relational mapping altogether in 2014
  * So not really an "ORM"
  * Just maps to data, not objects
* Most of the work done by Piotr Solnica

---

ROM
===

* Functional approach to persistence
* Focus on mapping to domain data types
* Promotes immutable objects
* Promotes separation between reading and writing
  * Command Query Responsibility Segregation (CQRS)
* Architecture has strong separation of concerns
  * Can implement DDD or a true ORM on top of its components

???

* Developers really good at small, independent, low-level composable libraries
* Some of the leaders of the movement toward FP and immutability in Ruby
  * A bit focused on low-level details at times
  * End up taking longer than expected, but really high quality code

---

Perpetuity
==========

* Worth looking at
* Simple
* Implements the Data Mapper pattern
* Supports PostgreSQL, MongoDB, in-memory
* Identity Map

---

Mongoid and MongoMapper
=======================

* You probably should not be using MongoDB
  * See [Sarah Mei's essay][no-mongo]
* Mongoid
  * Pretty simple
  * Pretty stable
  * Be sure to turn on MongoDB persistence!
* MongoMapper
  * No longer well-maintained

???

* Sarah Mei's article basically says you'll need relations later
* And that the structure of your data has no value
  * Paints you into a corner with no references
* MongoMapper hasn't been updated much in 2 years
  * Still at version 0.13
  * No support for Ruby 2.2 or Rails 4.1+

---

No ORM
======

* POROs
* Defer persistence until last responsible moment
  * You might not ever get there
* MagLev

???

* POROs = plain old Ruby objects
* MagLev is a SmallTalk-derived Ruby implementation
  * It has object persistence built in - no DB required

---

Further Info
============

* [The State of Ruby ORM][state-of-orm] (2011)
* [DataMapper Retrospective][datamapper-retro] (2011)
* [Sequel is awesome and much better than ActiveRecord][sequel-awesome]
* [Why You Should Never Use MongoDB][no-mongo] (Sarah Mei)
* [ORM Hate][orm-hate] (Martin Fowler)
* [Turning the Tables: How to Get Along with your Object-Relational Mapper][turning-tables]

---

Colophon
========

* [Remark][remark] - JavaScript slide show from Markdown

---

Feedback
========

* Twitter: [@CraigBuchek][twitter]
* GitHub: [booch][github]
* Email: craig@boochtek.com


* Slides: http://tinyurl.com/ar-alt-wcr
* Slides: https://github.com/booch/presentations/


[rr-222]: http://devchat.cachefly.net/rubyrogues/transcript-222-rr-rails-5-with-sean-griffin-ruby-rogues.pdf
[peap]: http://www.amazon.com/Patterns-Enterprise-Application-Architecture-Martin/dp/0321127420
[no-mongo]: http://www.sarahmei.com/blog/2013/11/11/why-you-should-never-use-mongodb/
[state-of-orm]: http://solnic.eu/2011/11/29/the-state-of-ruby-orm.html
[datamapper-retro]: http://rhnh.net/2011/11/29/datamapper-retrospective
[sequel-awesome]: http://rosenfeld.herokuapp.com/en/articles/ruby-rails/2013-12-18-sequel-is-awesome-and-much-better-than-activerecord
[orm-hate]: http://java.dzone.com/articles/martin-fowler-orm-hate
[turning-tables]: https://medium.com/@bradurani/turning-the-tables-how-to-get-along-with-your-object-relational-mapper-e5d2d6a76573


[twitter]: https://twitter.com/CraigBuchek
[github]: https://github.com/booch
[github-boochtek]: https://github.com/boochtek
[boochtek]: http://boochtek.com
[tal]: http://www.thisagilelife.com


[remark]: http://remarkjs.com/

    </textarea>
    <!-- <script src="https://gnab.github.io/remark/downloads/remark-latest.min.js"> -->
    <script src="remark-latest.min.js">
    </script>
    <script>
      var slideshow = remark.create();
      for (i = 0; slide = slideshow.getSlides[i]; )
      {
        slide.properties.class = "middle, center";
      }
    </script>
  </body>
</html>
